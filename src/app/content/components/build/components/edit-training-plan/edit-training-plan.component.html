<div class="content-container" fxLayout="column" fxLayoutAlign="center center">
  <div class="back-button-container" fxLayout="row" fxLayoutAlign="start center" (click)="onNavigateUserToBrowse()">
    <button class="back-button" mat-icon-button><mat-icon>arrow_back</mat-icon></button>
  </div>
  <div class="plan-details-container" fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="16px" fxFill>
    <div *ngIf="$currentTrainingPlan() as trainingPlanData" [fxShow]="!$editTrainingPlanDetails()" class="plan-title-container" fxLayout="row" fxLayoutAlign="center center">
      <div fxFlex="95" class="plan-title">{{ trainingPlanData.title }}</div>
      <button class="action-button" fxFlex="5" mat-icon-button (click)="onEditTrainingPlanDetails()" aria-label="Edit training session">
        <mat-icon>edit</mat-icon>
      </button>
    </div>
    <form class="training-plan-form" [fxShow]="$editTrainingPlanDetails()" [formGroup]="trainingPlanForm" fxLayout="column" fxLayoutAlign="center center">
      <div class="form-title"> {{ $isNewPlan() ? CREATE_TRAINING_PLAN_TITLE_VALUE : EDIT_TRAINING_PLAN_TITLE_VALUE  }}</div>
      <mat-form-field class="edit-title-field">
        <mat-label>{{ TITLE_FIELD_VALUE }}</mat-label>
        <input class="edit-title-input" [formControl]="title" matInput type="text">
        <mat-hint>{{ title.value.length }}/{{ TITLE_MAX_LENGTH }}</mat-hint>
      </mat-form-field>
      <mat-error *ngFor="let validation of FORM_VALIDATION_MESSAGES.title">
        <mat-error *ngIf="title.hasError(validation.type) && title.invalid && (title.dirty || title.touched)">{{ validation.message }}</mat-error>
      </mat-error>
      <div class="form-actions" fxLayout="column" fxLayoutAlign="center center" fxLayout.gt-md="row" fxLayoutGap="16px">
        <button class="action-button" *ngIf="!(serverRequestProcessing$ | async)" [disabled]="!trainingPlanForm.valid" mat-raised-button color="primary" type="button" (click)="onSubmitTrainingPlanForm()">
          {{ $isNewPlan() ? CREATE_TRAINING_PLAN_BUTTON_VALUE : SUBMIT_BUTTON_VALUE }}
        </button>
        <button class="action-button" *ngIf="!(serverRequestProcessing$ | async)" mat-stroked-button color="primary" type="button" (click)="onCancelTitleUpdate()">
          {{ CANCEL_BUTTON_VALUE }}
        </button>
      </div>
    </form>
  </div>
  <div *ngIf="(serverRequestProcessing$ | async) && !(batchRequestProcessing$ | async) && !(deletePlanSessionFragmentProcessing$ | async)" fxLayout="column" fxLayoutAlign="center center">
    <mat-progress-spinner diameter=40 color="primary" mode="indeterminate"></mat-progress-spinner>
  </div>
  <div *ngIf="!$editTrainingPlanDetails() && $currentTrainingPlan() && $currentPlanSessionFragments()" class="plan-sessions-container" fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="32px">
    <div class="plan-actions-button-container" fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="16px">
      <button class="action-button" mat-raised-button color="primary" type="button" [disabled]="(serverRequestProcessing$ | async)" (click)="onAddTrainingSession($currentTrainingPlan()?.id)">
        {{ ADD_A_TRAINING_SESSION_BUTTON_VALUE }}
      </button>
      <button class="action-button" mat-stroked-button color="primary" type="button" [disabled]="(serverRequestProcessing$ | async)" (click)="onDeleteTrainingPlan()">
        {{ DELETE_TRAINING_PLAN_BUTTON_VALUE }}
      </button>
    </div>
    <div *ngIf="!(deletePlanSessionFragmentProcessing$ | async)" class="drag-drop-list" cdkDropList (cdkDropListDropped)="onListItemDrop($event)">
      <div class="training-session-card-container drag-drop-item" cdkDrag *ngFor="let fragment of $currentPlanSessionFragments()">
        <div class="drop-placeholder" *cdkDragPlaceholder></div>
        <div class="training-session-card-details" fxLayout="row" fxLayoutAlign="center start">
          <mat-icon fxFlex="15" fxFlex.gt-xs="10" class="drag-drop-icon" ngClass.gt-xs="desktop">drag_indicator</mat-icon>
          <app-training-session-card fxFlex="75" fxFlex.gt-xs="80" [trainingSesssionData]="fragment" [compressedDisplay]="true" fxLayout="column" (click)="onSelectTrainingSession(fragment)"></app-training-session-card>
          <mat-icon fxFlex="15" fxFlex.gt-xs="10" class="delete-icon" ngClass.gt-xs="desktop" (click)="onDeletePlanSessionFragment(fragment, $currentTrainingPlan())">delete</mat-icon>
        </div>
      </div>
    </div>
    <div *ngIf="deletePlanSessionFragmentProcessing$ | async" fxLayout="column" fxLayoutAlign="center center">
      <mat-progress-spinner diameter=40 color="primary" mode="indeterminate"></mat-progress-spinner>
    </div>
  </div>
</div>