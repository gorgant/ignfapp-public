<div fxLayout="column" fxLayoutAlign="center center">

  <h2 class="section-header" mat-dialog-title>{{ UPDATE_EMAIL_TITLE_VALUE }}</h2>

  <mat-stepper [orientation]="stepperOrientation" [linear]="true" labelPosition="bottom" #updateEmailStepper>

    <!-- Step 1 -->
    <!-- No stepControl here, instead we use the "completed" api for async validation -->
    <mat-step errorMessage="Error verifying password." [completed]="false" [editable]="false">
      <form [formGroup]="passwordForm">
        
        <ng-template matStepLabel>{{ VERIFY_PASSWORD_STEP_LABEL }}</ng-template>
      
        <div fxLayout="column" fxLayoutAlign="center start" fxLayoutAlign.gt-sm="center center">
          <mat-form-field>
            <input formControlName="password" matInput type="password" placeholder="Current Password">
            <mat-error *ngFor="let validation of FORM_VALIDATION_MESSAGES.password">
              <mat-error *ngIf="password.hasError(validation.type) && password.invalid && (password.dirty || password.touched)">{{ validation.message }}</mat-error>
            </mat-error>
          </mat-form-field>
          
          <div class="stepper-buttons" fxLayout="column" fxLayoutAlign="start center" fxLayoutGap="8px" fxLayout.gt-md="row">
            
            <button *ngIf="!(combinedAuthAndUserUpdateProcessing$ | async)" mat-raised-button color="primary" [disabled]="passwordForm.invalid" (click)="onConfirmPasswordInAuth()">{{ VERIFY_PASSWORD_BUTTON_VALUE }}</button>
            <button *ngIf="!(combinedAuthAndUserUpdateProcessing$ | async)" mat-stroked-button color="primary" [mat-dialog-close] type="button">{{ CANCEL_BUTTON_VALUE }}</button>
            <div *ngIf="(combinedAuthAndUserUpdateProcessing$ | async)" fxLayout="column" fxLayoutAlign="center center">
              <mat-progress-spinner diameter=40 color="primary" mode="indeterminate"></mat-progress-spinner>
            </div>
          </div>
        </div>

      </form>
    </mat-step>
  
    <!-- Step 2 -->
    <mat-step errorMessage="Error updating email.">
      <form [formGroup]="emailForm" fxLayout="column" fxLayoutAlign="center center">

        <ng-template matStepLabel>{{ INPUT_NEW_EMAIL_STEP_LABLE }}</ng-template>
        
        <div class="new-email-container" [fxHide]="$sendUpdateEmailConfirmationCycleComplete()" fxLayout="column" fxLayoutAlign="center start" fxLayoutAlign.gt-sm="center center">
          <mat-form-field>
            <input formControlName="email" matInput type="text" placeholder="Your new email...">
            <mat-error *ngFor="let validation of FORM_VALIDATION_MESSAGES.email">
              <mat-error *ngIf="email.hasError(validation.type) && email.invalid && (email.dirty || email.touched)">{{ validation.message }}</mat-error>
            </mat-error>
          </mat-form-field>
          
          <div class="stepper-buttons" fxLayout="column" fxLayoutAlign="start center" fxLayoutGap="8px" fxLayout.gt-md="row">
            
            <button *ngIf="!(combinedAuthAndUserUpdateProcessing$ | async)" mat-raised-button color="primary" (click)="onSendUpdateEmailConfirmation()">{{ SEND_UPDATE_EMAIL_BUTTON_VALUE }}</button>
            <button *ngIf="!(combinedAuthAndUserUpdateProcessing$ | async)" mat-stroked-button color="primary" [mat-dialog-close] type="button">{{ CANCEL_BUTTON_VALUE }}</button>
            <div *ngIf="(combinedAuthAndUserUpdateProcessing$ | async)" fxLayout="column" fxLayoutAlign="center center">
              <mat-progress-spinner diameter=40 color="primary" mode="indeterminate"></mat-progress-spinner>
            </div>

          </div>
        </div>

        <div [fxShow]="$sendUpdateEmailConfirmationCycleComplete()" fxLayout="column" fxLayoutAlign="center start" fxLayoutAlign.gt-sm="center center" fxLayoutGap="16px">
          <div>{{ CONFIRM_NEW_EMAIL_BLURB }}</div>
          <button *ngIf="!(combinedAuthAndUserUpdateProcessing$ | async)" mat-raised-button color="primary" [mat-dialog-close]="true">
            {{ IVE_CONFIRMED_MY_EMAIL_BUTTON_VALUE }}
          </button>
        </div>

      </form>
    </mat-step>
  
  </mat-stepper>

</div>
